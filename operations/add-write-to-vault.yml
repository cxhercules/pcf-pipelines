- op: add
  path: /resource_types/-
  value:
    name: curl
    type: docker-image
    source:
      repository: pivotalservices/concourse-curl-resource
      tag: latest

- op: add
  path: /resources/-
  value:
    name: vault
    type: curl
    source:
      url: https://releases.hashicorp.com/vault/0.8.1/vault_0.8.1_linux_amd64.zip
      filename: vault.zip

- op: add
  path: /jobs/-
  value:
    name: write-secrets-to-vault
    plan:
    - aggregate:
      - get: pcf-pipelines
      - get: vault 
      - get: pcf-ops-manager
        params: {globs: []}
        passed: [deploy-ert]
        trigger: true

    - task: write-secrets-to-vault
      file: pcf-pipelines/tasks/write-secrets-to-vault/task.yml
      params:
        VAULT_ADDR: {{vault_addr}}
        VAULT_TOKEN: {{vault_token}}
        FOUNDATION_NAME: {{foundation_name}}
        OPSMAN_DOMAIN_OR_IP_ADDRESS: {{opsman_uri}}
        OPSMAN_USERNAME: {{opsman_admin_username}}
        OPSMAN_PASSWORD: {{opsman_admin_password}}
